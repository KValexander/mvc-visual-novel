<script>
	function register() {
		// Serialize
		let form = $("form").serialize();

		// Server request
		request.post((data) => {
			// Data parsing
			data = JSON.parse(data);
			$("input").removeClass("err");
			$("p.error").html("").removeClass("error_acc");

			// Handling a successful registration
			if(data.status == 200) {
				message.show(data.data.message);
				route.redirect("index");
			}
			// Handling Validation Errors
			else if(data.status == 422) {
				$("input").addClass("acc")
				for(key in data.data.errors) {
					let error = data.data.errors[key];
					$("#"+key).html(error).addClass("error_acc");
					$(`input[name=${key}]`).addClass("err").removeClass("acc");
				}
			}
		}, form, "api/register");

		return false;
	}
</script>

<div class="content">
	<form onsubmit="return register()">
		<fieldset>
			<legend>Регистрация</legend>
			<p class="error" id="username"></p>
			<input type="text" placeholder="Имя пользователя" name="username">
			<p class="error" id="email"></p>
			<input type="text" placeholder="Email" name="email">
			<p class="error" id="login"></p>
			<input type="text" placeholder="Логин" name="login">
			<p class="error" id="coincidence"></p>
			<p class="error" id="password"></p>
			<input type="password" placeholder="Пароль" name="password">
			<p class="error" id="password_check"></p>
			<input type="password" placeholder="Подтверждение пароля" name="password_check">
			<input type="submit" value="Зарегистрироваться">
			<p class="note">Вы уже зарегистрированы? <a class="underline" onclick="route.redirect('login')">Желаете войти?</a></p>
		</fieldset>
	</form>
</div>